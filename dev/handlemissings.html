<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Default · MissingStrategies.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MissingStrategies.jl</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><a class="tocitem" href="missingstrategy.html">Types</a></li><li><a class="tocitem" href="iseltypesuperofmissing.html">Dispatch</a></li><li class="is-active"><a class="tocitem" href="handlemissings.html">Default</a><ul class="internal"><li><a class="tocitem" href="#Main-macros"><span>Main macros</span></a></li><li><a class="tocitem" href="#Infrastructure"><span>Infrastructure</span></a></li></ul></li><li><a class="tocitem" href="typediter.html">TypedIterator</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="handlemissings.html">Default</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="handlemissings.html">Default</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/bgctw/MissingStrategies.jl/blob/master/docs/src/handlemissings.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Default-Handling-of-missing-values"><a class="docs-heading-anchor" href="#Default-Handling-of-missing-values">Default Handling of missing values</a><a id="Default-Handling-of-missing-values-1"></a><a class="docs-heading-anchor-permalink" href="#Default-Handling-of-missing-values" title="Permalink"></a></h1><p>Several functions and macros help to extend functions  that were designed not taking care of missing values. </p><h2 id="Main-macros"><a class="docs-heading-anchor" href="#Main-macros">Main macros</a><a id="Main-macros-1"></a><a class="docs-heading-anchor-permalink" href="#Main-macros" title="Permalink"></a></h2><p>The main tools are macros </p><ul><li><code>@handlemissings_stub</code>: defines only the dispatch infrastructure to be  extended manually</li><li><code>@handlemissings_typed</code>: additionally defines default handling for  <code>PassMissing</code> and <code>SkipMissing</code> for arguments whose eltye does not match missings</li><li><code>@handlemissings_any</code>: define these handling  for arguments whose eltype does match missings including <code>Any</code>.</li></ul><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.@handlemissings_stub" href="#MissingStrategies.@handlemissings_stub"><code>MissingStrategies.@handlemissings_stub</code></a> — <span class="docstring-category">Macro</span></header><section><div><p>@handlemissings_stub(fun, ...)</p><p>Calling <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a> with just creating the disaptching matches but no implementations yet that handling missings.</p><ul><li>Default to using argument type Any and providing no default strategy  (use arguments to change this.)</li><li>Method with inserted MissingStrategy argument that forwards to the dispatching function</li><li>A dispaching method for eltypes not allowing for missings for any MissingStrategy that calls the original function without the MissingStrategy.</li></ul><p>Arguments: see <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a>    </p><p>One then can define the other methods yourself using Simpletraits <code>@traitfn</code>.</p><pre><code class="language-julia">using SimpleTraits
f1(x::AbstractArray{&lt;:Real}) = &quot;method that is not accepting missings in eltype&quot;
@handlemissings_stub(
  # signature matching that of the original function to be called
  f1(x::AbstractArray{&lt;:Real}) = 0,
  # pos_missing, pos_strategy, type_missing, defaultstrategy
  1,2,AbstractArray{&lt;:Union{Missing,Real}}, PassMissing()
) 
methods(f1) # just to see that new methods have been defined
# the new methods forward to new function f1_hm that can be extended for special cases
# note the argument order: missing strategy comes first in the dispatching function
@traitfn function f1_hm(ms::PassMissing, x::::IsEltypeSuperOfMissing) 
  &quot;method handling missings in eltype&quot;
end
f1([1.0,2.0]) == &quot;method that is not accepting missings in eltype&quot;
f1([1.0,2.0], PassMissing()) == &quot;method that is not accepting missings in eltype&quot;
f1([1.0,2.0,missing]) == &quot;method handling missings in eltype&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/handlemissings.jl#L1-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.@handlemissings_typed" href="#MissingStrategies.@handlemissings_typed"><code>MissingStrategies.@handlemissings_typed</code></a> — <span class="docstring-category">Macro</span></header><section><div><p>@handlemissings_typed(fun, ...)</p><p>Calling <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a> with defaults tailored to an original method where the  eltype does not accepts missings:</p><ul><li>Dispatching methods as with <a href="handlemissings.html#MissingStrategies.@handlemissings_stub"><code>@handlemissings_stub</code></a></li><li>Argument type of the new function must be specified. May use <code>Any</code>. A default method (without <code>MissingStrategy</code> argument) is created that forwards to the  PassMissing method. Hence, Make sure that the argument type differs from the original method so that the original method its not overwritten.</li><li>PassMissing method calls the original method with an broadcast where each element has been converted to the corresponding nonmissing type (<a href="handlemissings.html#MissingStrategies.mgen.passmissing_convert-Tuple{}"><code>mgen.passmissing_convert</code></a>).</li><li>SkipMissing method collects the skipmissing object before calling the original function (<a href="handlemissings.html#MissingStrategies.mgen.handlemissing_collect_skip-Tuple{}"><code>mgen.handlemissing_collect_skip</code></a>).</li></ul><p>Arguments: see <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a>    </p><p><strong>Note on default MissingStrategy</strong></p><p>Note, that defining a default Missingstrategy at an argument position before further  optional arguments behaves in a way that may not be intuitive.</p><pre><code class="language-julia">f2(x::AbstractArray{&lt;:Real},optarg=1:3) = x
@handlemissings_typed(f2(x::AbstractArray{&lt;:Real},optarg=1:3)=0,1,2,Any)
# f2(x,ms::MissingStrategy=PassMissing(),optarg=1:3) # generated
# f2([1.0,missing], 2:4) # no method defined -&gt; rethink argument ordering</code></pre><p>In order to call the PassMissing variant in the above case, one would need to  call <code>@handle_missing_typed</code> separately for the method with a single and the method with two arguments  and place the default missing strategy behind the second argument in the second case.</p><pre><code class="language-julia">f3(x::AbstractArray{&lt;:Real},optarg=1:3) = x
@handlemissings_typed(f3(x::AbstractArray{&lt;:Real})=0,1,2,Any)
@handlemissings_typed(f3(x::AbstractArray{&lt;:Real}, optarg)=0,1,3,Any)
ismissing(f3([1.0,missing], 2:4))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/handlemissings.jl#L46-L83">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.@handlemissings_any" href="#MissingStrategies.@handlemissings_any"><code>MissingStrategies.@handlemissings_any</code></a> — <span class="docstring-category">Macro</span></header><section><div><p>@handlemissings_any(fun, ...)</p><p>Calling <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a> with defaults tailored to an original method where the  eltype accepts missings already:</p><ul><li>Dispatching methods as with <a href="handlemissings.html#MissingStrategies.@handlemissings_stub"><code>@handlemissings_stub</code></a></li><li>Agument type of the new function defaults to <code>Any</code>. No default method (without the <code>MissingStragety</code> argument) is created.</li><li>PassMissing methods calls the original directly without converting the type of the  argument with missings (<a href="handlemissings.html#MissingStrategies.mgen.passmissing_nonconvert-Tuple{}"><code>mgen.passmissing_nonconvert</code></a>).</li><li>HandleMissing methods calls the original directly with the <code>skipmissing()</code>  iterator object (<a href="handlemissings.html#MissingStrategies.mgen.handlemissing_skip-Tuple{}"><code>mgen.handlemissing_skip</code></a>).</li></ul><p>Arguments: see <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a>    </p><p>Note, that if the original method allows <code>missing</code> in <code>eltype</code>, you need to explicitly pass the <code>PassMissing()</code> by argument. A potential default method would override the original method and either not be called at all or call itself recursively causing an infinite loop.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/handlemissings.jl#L110-L129">source</a></section></article><h2 id="Infrastructure"><a class="docs-heading-anchor" href="#Infrastructure">Infrastructure</a><a id="Infrastructure-1"></a><a class="docs-heading-anchor-permalink" href="#Infrastructure" title="Permalink"></a></h2><p>The macros above just wrap a call to the <code>handlemissings</code> function using  different argument values, especially different generator functions.</p><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.handlemissings" href="#MissingStrategies.handlemissings"><code>MissingStrategies.handlemissings</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">handlemissings(fun, ...)</code></pre><p>Creates an expression that defines new methods that allow missings in the  eltype of an argument.</p><p><strong>Arguments</strong></p><ul><li><code>fun</code>: Expression of a function to extend</li><li><code>pos_missing = 1</code>: The postition of the argument that should handle missings</li><li><code>pos_strategy = pos_missing + 1</code>: The position at which the argument of MissingStrategy  is to be inserted into the function signature</li><li><code>type_missing = :Any</code>: The new type of the argument that should handle missings.  This can be an expression of the value.</li><li><code>defaultstrategy::Union{Nothing,MissingStrategy} = :nothing</code>: the value of the default  of the strategy argument. Use <code>:nothing</code> to indicate not specifying a default value. This can be an expression of the value.</li><li><code>gens = ()</code>: Tuple of generator functions (see [mgen]{@ref})</li><li><code>argname_strategy = :ms</code>: symbol of the argument name of the strategy argument</li><li><code>suffix=&quot;_hm&quot;</code>: attached to the name of the dispatching function to avoid method ambiguities</li></ul><p>Ususually this function is called from a macro that povide suitable dfault values</p><ul><li><a href="handlemissings.html#MissingStrategies.@handlemissings_typed"><code>@handlemissings_typed</code></a> suitable if the type of the original method does not allow missing value</li><li><a href="handlemissings.html#MissingStrategies.@handlemissings_any"><code>@handlemissings_any</code></a> suitable if the type of the original method does allow missing value. </li><li><a href="handlemissings.html#MissingStrategies.@handlemissings_stub"><code>@handlemissings_stub</code></a> suitable for writing user-specified handling routines. </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/handlemissings.jl#L154-L181">source</a></section></article><p>The SimpleTraits package together with the <a href="iseltypesuperofmissing.html#MissingStrategies.IsEltypeSuperOfMissing"><code>IsEltypeSuperOfMissing</code></a> trait  is used to dispatch to different methods depending on whether the eltype of a given argument allows for missing or does not allow for missings.</p><p>The orginal method is extended by a method signature with modified the type of a given argument, usually to eltype <code>Union{Missing,&lt;eltype_orig&gt;}</code> and an additional argument <code>ms::MissingStrategy</code>. The new method forwards to a dispatching function of name <code>&lt;name_orig&gt;_&lt;suffix&gt;</code> with MissingStrategy as the first argument and  given argument <code>x</code> of type <code>x::::IsEltypeSuperOfMissing</code>. The suffix defaults to &quot;_hm&quot;  but an be changed to avoid method ambiguities if methods are extended that differ only by the original type of <code>x</code>. A further advantage of using a separate dispatching method is, that  the original function is not extended by too many new methods.</p><p>The dispatching function can be extended by <code>SimpleTraits.@traitfn</code> to handle the differnt combinations of whether eltye of x was missing or not and the different Missing strategies. See <a href="handlemissings.html#MissingStrategies.@handlemissings_stub"><code>@handlemissings_stub</code></a> for an example.</p><h3 id="Generator-functions"><a class="docs-heading-anchor" href="#Generator-functions">Generator functions</a><a id="Generator-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Generator-functions" title="Permalink"></a></h3><p>The argument <code>gens</code> of <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a> takes a tuple of generator functions,  that do the actual work of defining additional methods.</p><p>The used generator functions are defined in submodule <code>mgen</code></p><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen" href="#MissingStrategies.mgen"><code>MissingStrategies.mgen</code></a> — <span class="docstring-category">Module</span></header><section><div><p>Submodule defining functions that generate specific methods that handle missings. They are called from within <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a>.</p><p>The keyword arguments of the generator functions correspond to entries in  <a href="handlemissings.html#MissingStrategies.getdispatchinfo"><code>getdispatchinfo</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L1-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen.forwarder-Tuple{}" href="#MissingStrategies.mgen.forwarder-Tuple{}"><code>MissingStrategies.mgen.forwarder</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">forwarder(...)</code></pre><p>Defines a method with new type of missing argument and MissingStrategy inserted forwarding to dispatching function of new name with MissingStrategy at first position.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L22-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen.missingstrategy_notsuperofeltype-Tuple{}" href="#MissingStrategies.mgen.missingstrategy_notsuperofeltype-Tuple{}"><code>MissingStrategies.mgen.missingstrategy_notsuperofeltype</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">missingstrategy_notsuperofeltype(...)</code></pre><p>Defines a trait method for any MissingStrategy for arguments whose eltype does not allow   missing. This just forwards to the original function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L57-L62">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen.passmissing_nonconvert-Tuple{}" href="#MissingStrategies.mgen.passmissing_nonconvert-Tuple{}"><code>MissingStrategies.mgen.passmissing_nonconvert</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">passmissing_nonconvert(...)</code></pre><p>Defines a trait method for <code>PassMissing</code> for arguments whose eltype allowing missing. This method returns missing if any missing items are encoured or otherwise calls the original function with non-modified arguments, i.e. with type that  allows missings in its eltype.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L83-L90">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen.passmissing_convert-Tuple{}" href="#MissingStrategies.mgen.passmissing_convert-Tuple{}"><code>MissingStrategies.mgen.passmissing_convert</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">passmissing_convert(...)</code></pre><p>Defines a trait method for <code>PassMissing</code> for arguments whose eltype allowing missing. This method returns missing if any missing items are encoured or otherwise calls the original function, but converts the argument to the corresponding nonmissing type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L109-L116">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen.handlemissing_collect_skip-Tuple{}" href="#MissingStrategies.mgen.handlemissing_collect_skip-Tuple{}"><code>MissingStrategies.mgen.handlemissing_collect_skip</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">handlemissing_collect_skip(...)</code></pre><p>Defines a trait method for <code>HandleMissingStrategy</code>  for arguments whose eltype allows missings. This method transforms the argument by <code>collect(skipmissing(x))</code> before passing it on to the original function.</p><p>Hence it passes a vector with corresponding nonmissing eltype, but does require allocation.  </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L142-L152">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.mgen.handlemissing_skip-Tuple{}" href="#MissingStrategies.mgen.handlemissing_skip-Tuple{}"><code>MissingStrategies.mgen.handlemissing_skip</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">handlemissing_skip(...)</code></pre><p>Defines a trait method for <code>HandleMissingStrategy</code>  for arguments whose eltype allows missings. This method transforms the argument by <code>skipmissing(x)</code> before passing it on to the original function.</p><p>Hence it passes an itereator of undefined type but does not require allocations.  </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/mgen.jl#L175-L184">source</a></section></article><p>Each generator function requires arguments that are collected by and passed by splatting the dictionary results in the call of a generator function.</p><article class="docstring"><header><a class="docstring-binding" id="MissingStrategies.getdispatchinfo" href="#MissingStrategies.getdispatchinfo"><code>MissingStrategies.getdispatchinfo</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">getdispatchinfo(...)</code></pre><p>Collect information for dispatching non-missing types into a dictionary.</p><p><strong>Arguments</strong></p><p>see <a href="handlemissings.html#MissingStrategies.handlemissings"><code>handlemissings</code></a>.</p><p><strong>Return value</strong></p><p>A dictionary with entries   </p><ul><li><code>dict_forig</code>: dictionary result of MacroTools.splitdef(fun)</li><li><code>fname_disp</code>: Symbol of the dispatch function name, </li><li><code>argnames</code>: the aguement names of fun, </li><li><code>kwargpasses</code>: an Vector of expression of keyword parameters &#39;argname = argname&#39;</li><li><code>pos_missing</code>: position of the argument that should handle missings, </li><li><code>type_missing</code>: the new type of that argument,</li><li><code>pos_strategy</code>: the position at which the argument of MissingStrategy is inserted, </li><li><code>defaultstrategy</code>: the default of that argument of type <a href="missingstrategy.html#MissingStrategies.MissingStrategy"><code>MissingStrategy</code></a></li><li><code>suffix=&quot;_hm&quot;</code>: number to be appended to <code>fname_disp</code> to avoid method ambiguities,</li></ul><p>These match the required argument for the method generators in module <a href="handlemissings.html#MissingStrategies.mgen"><code>mgen</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bgctw/MissingStrategies.jl/blob/d46b4e57b01bad9bd0f36367b9845978288f8a9a/src/handlemissings.jl#L203-L224">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="iseltypesuperofmissing.html">« Dispatch</a><a class="docs-footer-nextpage" href="typediter.html">TypedIterator »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 29 March 2021 08:55">Monday 29 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
